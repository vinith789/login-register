<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Allwin Baby Shop Order</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="./css/navbar.css">
  <link rel="stylesheet" href="./css/order.css">
  <link rel="stylesheet" href="./css/footer.css">
  <link rel="stylesheet" href="./css/perloader.css">
</head>
<body>

  <!-- Preloader (always first) -->
<div id="preloader" class="preloader">
  <div class="spinner"></div>
</div>

<main  id="main-content" style="display:none;">
  <!-- Top Navbar -->
<div class="top-nav">
  <button id="orderbtn"><i class="fas fa-receipt"></i> Order</button>
  <button id="cartBtn">
    <i class="fas fa-shopping-cart"></i> Cart
    <span id="cartCount" class="cart-count"></span>
  </button>
</div>

<!-- Main Navbar -->
<div class="main-nav">
  <div class="logo-section">
    <img src="./image/logo.jpg" alt="Logo">
    <div class="shop-text">
      <h5>Allwin Baby Shop</h5>
      <small>Happy Toys Happy Kids</small>
    </div>
  </div>

  <!-- Hamburger / Close Icon -->
  <div class="hamburger" id="hamburger" onclick="toggleMenu()">
    <i class="fas fa-bars"></i>
  </div>

  <div class="nav-links" id="navLinks">
    <a href="/user/home">Home</a>
    <a href="/user/about">About</a>
    <a href="/user/shop">Shop</a>
    <a href="/user/mall">Fun Mall</a>
    <a href="/user/contact">Contact</a>
    <a href="/logout">Logout</a>
  </div>
</div>
<h2 id="order-heading">My Orders</h2>
<div id="ordersContainer"></div>

<!-- footer content -->

<footer class="footer">
    <div class="footer-container">

      <!-- Logo & About -->
      <div class="footer-logo">
        <img src="./logo" alt="">
        <h2>Allwin Baby Shop</h2>
        <span>Happy Toys, Happy Kids</span>
        <p>Your trusted partner for quality toys that spark imagination and create joyful memories for children of all ages.</p>
        <div class="social-icons">
          <a href="#"><i class="fab fa-facebook-f"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
          <a href="#"><i class="fab fa-twitter"></i></a>
          <a href="#"><i class="fab fa-youtube"></i></a>
        </div>
      </div>

      <!-- Quick Links -->
      <div class="footer-links">
        <h3>Quick Links</h3>
        <ul>
          <li><a href="/user/about">About Us</a></li>
          <li><a href="/user/contact">Contact Us</a></li>
          <li><a href="/user/contact">FAQs</a></li>
          <li><a href="/user/shop">Shop</a></li>
          <li><a href="/user/mall">Fun Mall</a></li>
          <li><a href="/user/contact">Shipping Info</a></li>
        </ul>
      </div>

      <!-- Categories -->
      <div class="footer-categories">
        <h3>Categories</h3>
        <ul>
          <li><a href="/user/shop">Soft Toys</a></li>
          <li><a href="/user/shop">Educational Toys</a></li>
          <li><a href="/user/shop">Action Figures</a></li>
          <li><a href="/user/shop">Outdoor Toys</a></li>
          <li><a href="/user/shop">Dolls</a></li>
          <li><a href="/user/shop">Musical Toys</a></li>
        </ul>
      </div>

      <!-- Contact -->
      <div class="footer-contact">
        <h3>Contact Us</h3>
        <p><i class="fas fa-map-marker-alt"></i>Allwin Baby Shop, High School Road, Thirkadai Building, Paramathi Velur, Namakkal - 638182</p>
        <p><i class="fas fa-phone"></i>+91 99943 85838</p>
        <p><i class="fas fa-envelope"></i>hello@allwinbaby.com</p>

        <div class="store-hours">
          <strong>Store Hours</strong><br>
          Everyday: 09:30 AM - 9:00 PM<br>
        </div>
      </div>
    </div>

    <!-- Footer Bottom -->
    <div class="footer-bottom">
      © 2025 Allwin Baby Shop. All rights reserved. Made with <span>❤</span> for kids.
    </div>
  </footer>
</main>
<script>
async function loadUserOrders() {
  try {
    const res = await fetch("/api/order/my-orders");
    if (!res.ok) throw new Error("Please login first");

    const orders = await res.json();
    const container = document.getElementById("ordersContainer");
    container.innerHTML = "";

    orders.forEach(order => {
      const productsHTML = order.products.map(p => `
        <tr>
          <td><img src="../..${p.image}" alt="Product" width="60"></td>
          <td>${p.productId}</td>
          <td>${p.name}</td>
          <td>${p.selectedColor || "Default Color"}</td>
          <td>${p.qty}</td>
          <td>$${p.subtotal}</td>
        </tr>
      `).join("");

      const orderDiv = document.createElement("div");
      orderDiv.classList.add("order-card"); // use CSS styling
      orderDiv.innerHTML = `
        <h3 class="order-id">Order ID: ${order._id}</h3>
        <p class="animated-status">
          Status: <b class="status">${order.status}</b> |
          ${
            order.status === "Delivered" ? `Delivered On:<b class="delivery">${new Date(order.deliveredAt).toLocaleDateString()}</b>` :`Delivery Estimate: <b class="delivery">${order.deliveryEstimate} </b>`
            }
        </p>
        <p>Total Qty: ${order.totalQty} | Total Price: $${order.totalPrice}</p>
        <h4>Products:</h4>
        <div class="table-container">
          <table id="orderTable">
            <tr>
              <th>Image</th>
              <th>Product ID</th>
              <th>Name</th>
              <th>Color</th>
              <th>Qty</th>
              <th>Subtotal</th>
            </tr>
            ${productsHTML}
          </table>
        </div>
        <h4 id="addressHeading">Delivery Address:</h4>
        <p>
          ${order.address.fullname}<br>
          ${order.address.address}, ${order.address.building}<br>
          ${order.address.city}, ${order.address.state} - ${order.address.pincode}<br>
          Mobile: ${order.address.mobile}
        </p>
      `;
      container.appendChild(orderDiv);

      // Animate status/delivery
      const statusEl = orderDiv.querySelector(".status");
      const deliveryEl = orderDiv.querySelector(".delivery");
      statusEl.classList.add("fadeIn");
      deliveryEl.classList.add("fadeInDelay");
    });
  } catch (err) {
    console.error(err);
    document.getElementById("ordersContainer").innerHTML = "<p>Please login to view your orders.</p>";
  }
}

loadUserOrders();


</script>


<script src="./js/script.js"></script>
<script src="./js/cart-number.js"></script>
<script src="./js/perloader.js"></script>
</body>
</html>
